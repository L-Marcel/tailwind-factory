"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.Post=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _tailwind=require("./factory/tailwind");var _checkLayer3=require("./utils/checkLayer");var _isIntrinsicElement=require("./utils/isIntrinsicElement");var _stringToArray=require("./utils/stringToArray");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}var Post=/*#__PURE__*/function(){function Post(){(0,_classCallCheck2["default"])(this,Post)}(0,_createClass2["default"])(Post,null,[{key:"getMapOfClasses",value:function getMapOfClasses(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var classes=arguments.length>1?arguments[1]:undefined;var haveArrow=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var mapOfClasses=(0,_stringToArray.stringToArray)(classes);var mainClasses=[];var layer=0;var blockType=[];var commaDetected=false;var blockContent=[];var childrenIndex=-1;var canBeABlock=false;var withArrow=false;var isInsideBlock=false;var result=mapOfClasses.reduce(function(prev,cur,index,list){var _checkLayer=(0,_checkLayer3.checkLayer)(isInsideBlock,layer,cur),_checkLayer2=(0,_slicedToArray2["default"])(_checkLayer,2),isStillInsideBlock=_checkLayer2[0],currentLayer=_checkLayer2[1];isInsideBlock=isStillInsideBlock;layer=currentLayer;if(isInsideBlock){blockContent.push(cur);return prev}else if(!isInsideBlock&&canBeABlock&&cur==="}"){canBeABlock=false;blockContent.shift();prev.children[childrenIndex].elementClassNames=blockContent.join(" ")}var hasComma=cur.endsWith(",");var possibleElement=hasComma?cur.replace(",",""):cur;var startWithDot=cur.startsWith(".");var startWithHashTag=cur.startsWith("#");commaDetected=hasComma;var nextElementIsKey=index<list.length-1&&list[index+1]==="{"||hasComma;if(!canBeABlock&&!canBeABlock&&nextElementIsKey&&((0,_isIntrinsicElement.isIntrinsicElement)(possibleElement)||startWithDot||startWithHashTag)){blockContent=[];if(!commaDetected){childrenIndex++;canBeABlock=true;withArrow=false;prev.children.push({type:[].concat((0,_toConsumableArray2["default"])(blockType),[cur]),children:[],withArrow:false,elementClassNames:""});blockType=[]}else{blockType.push(possibleElement)}return prev}else if(!canBeABlock&&!canBeABlock&&cur===">"){blockContent=[];canBeABlock=true;withArrow=true;return prev}if(canBeABlock&&withArrow&&!isInsideBlock){if(!commaDetected){childrenIndex++;prev.children.push({type:[].concat((0,_toConsumableArray2["default"])(blockType),[cur]),withArrow:true,children:[],elementClassNames:""});blockType=[]}else{blockType.push(possibleElement)}return prev}if(!canBeABlock&&!isInsideBlock&&cur!=="}"&&!nextElementIsKey){mainClasses.push(cur)}return prev},{elementClassNames:"",children:[],withArrow:haveArrow,type:type});result.elementClassNames=mainClasses.join(" ");for(var c in result.children){var children=result.children[c];result.children[c]=this.getMapOfClasses(children.type,children.elementClassNames,children.withArrow)}return result}},{key:"applyMappedClasses",value:function applyMappedClasses(children,mappedClasses){var _this=this;var haveMoreThanOneChildren=Array.isArray(children);var listOfChildren=haveMoreThanOneChildren?(0,_toConsumableArray2["default"])(children):[children];var _loop=function _loop(c){var _currentChildren$prop,_currentChildren$prop2,_currentChildren$prop3,_newChildren$props2,_newChildren$props3,_newChildren$props4,_newChildren$props5,_newChildren$props$cl,_newChildren$props6;if(typeof listOfChildren[c]==="string"||typeof listOfChildren[c]==="number"){return"continue"}var currentChildren=_objectSpread({},listOfChildren[c]);var definedInlineClassNames=(_currentChildren$prop=(_currentChildren$prop2=currentChildren.props)===null||_currentChildren$prop2===void 0?void 0:_currentChildren$prop2.className)!==null&&_currentChildren$prop!==void 0?_currentChildren$prop:"";var firstClasses=[];var mapOfDefinedId=(0,_stringToArray.stringToArray)((_currentChildren$prop3=currentChildren.props)===null||_currentChildren$prop3===void 0?void 0:_currentChildren$prop3.id);var mapOfDefinedInlineClassNames=(0,_stringToArray.stringToArray)(definedInlineClassNames);currentChildren.props=_objectSpread(_objectSpread({},currentChildren.props),{},{className:""});for(var m in mappedClasses){var _currentChildren;var currentClass=mappedClasses[m];var isTheSameType=_this.isTheSameType(currentClass,(_currentChildren=currentChildren)===null||_currentChildren===void 0?void 0:_currentChildren.type,mapOfDefinedInlineClassNames,mapOfDefinedId,function(foundClass){if(definedInlineClassNames.includes(foundClass)){definedInlineClassNames=definedInlineClassNames.replace(foundClass,"");firstClasses.push(foundClass)}});var _newChildren=currentChildren;if(isTheSameType){var _newChildren$props;var classNameInProps=(_newChildren$props=_newChildren.props)===null||_newChildren$props===void 0?void 0:_newChildren$props.className;var inlineElementClassNames=classNameInProps?"".concat((0,_tailwind.removeWhiteSpaceInClasses)(classNameInProps)," "):"";_newChildren.props=_objectSpread(_objectSpread({},_newChildren.props),{},{className:inlineElementClassNames+currentClass.elementClassNames});listOfChildren[c]=_newChildren;currentChildren=listOfChildren[c]}}var newChildren=_objectSpread({},currentChildren);var haveChildren=((_newChildren$props2=newChildren.props)===null||_newChildren$props2===void 0?void 0:_newChildren$props2.children)&&typeof((_newChildren$props3=newChildren.props)===null||_newChildren$props3===void 0?void 0:_newChildren$props3.children)==="object";var newMappedClasses=haveChildren?mappedClasses.filter(function(mappedClass){var isTheSameType=_this.isTheSameType(mappedClass,newChildren===null||newChildren===void 0?void 0:newChildren.type,mapOfDefinedInlineClassNames,mapOfDefinedId);return!mappedClass.withArrow||isTheSameType}).reduce(function(prev,mappedClass){var isTheSameType=_this.isTheSameType(mappedClass,newChildren===null||newChildren===void 0?void 0:newChildren.type,mapOfDefinedInlineClassNames,mapOfDefinedId);var withArrow=mappedClass.withArrow;if(isTheSameType&&withArrow){prev=[].concat((0,_toConsumableArray2["default"])(prev),(0,_toConsumableArray2["default"])(mappedClass.children))}else{prev=[].concat((0,_toConsumableArray2["default"])(prev),[mappedClass],(0,_toConsumableArray2["default"])(mappedClass.children))}return prev},[]):[];var newChildrenInProps=haveChildren?_this.applyMappedClasses(((_newChildren$props4=newChildren.props)===null||_newChildren$props4===void 0?void 0:_newChildren$props4.children)||[],newMappedClasses):(_newChildren$props5=newChildren.props)===null||_newChildren$props5===void 0?void 0:_newChildren$props5.children;var classNamesInProps=(_newChildren$props$cl=(_newChildren$props6=newChildren.props)===null||_newChildren$props6===void 0?void 0:_newChildren$props6.className)!==null&&_newChildren$props$cl!==void 0?_newChildren$props$cl:"";var newDefinedInlineClassNames=definedInlineClassNames?"".concat(classNamesInProps?" ":"").concat((0,_tailwind.removeWhiteSpaceInClasses)(definedInlineClassNames)):"";var newFirstClasses="".concat(firstClasses.join(" ")).concat(firstClasses.length>=1&&(classNamesInProps||newDefinedInlineClassNames)?" ":"");newChildren.props=_objectSpread(_objectSpread({},newChildren.props),{},{children:newChildrenInProps,className:newFirstClasses+classNamesInProps+newDefinedInlineClassNames});listOfChildren[c]=newChildren;currentChildren=listOfChildren[c]};for(var c in listOfChildren){var _ret=_loop(c);if(_ret==="continue")continue}return listOfChildren}},{key:"isTheSameType",value:function isTheSameType(mappedClass,childrenType,classes,ids,onMatchClassType){var _mappedClass$type;var hasTheSameType=(_mappedClass$type=mappedClass.type)===null||_mappedClass$type===void 0?void 0:_mappedClass$type.includes(childrenType);var hasTheSameClassType=classes.some(function(definedClass){var _mappedClass$type2;var hasTheSameClass=(_mappedClass$type2=mappedClass.type)===null||_mappedClass$type2===void 0?void 0:_mappedClass$type2.includes("."+definedClass);if(hasTheSameClass){onMatchClassType&&onMatchClassType(definedClass)}return hasTheSameClass});var hasTheSameIdType=ids.some(function(definedId){var _mappedClass$type3;return(_mappedClass$type3=mappedClass.type)===null||_mappedClass$type3===void 0?void 0:_mappedClass$type3.includes("#"+definedId)});return hasTheSameType||hasTheSameClassType||hasTheSameIdType}},{key:"children",value:function children(_children){var classes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var _this$getMapOfClasses=this.getMapOfClasses([],classes),mappedClasses=_this$getMapOfClasses.children,elementClassNames=_this$getMapOfClasses.elementClassNames;// eslint-disable-next-line @typescript-eslint/no-explicit-any
var newChildren=[];if(_children){for(var c in _children){var currentChildren=_children[c];if(typeof currentChildren==="string"){newChildren.push(currentChildren)}else if(currentChildren){var result=this.applyMappedClasses(currentChildren,mappedClasses);newChildren=[].concat((0,_toConsumableArray2["default"])(newChildren),(0,_toConsumableArray2["default"])(result))}else{newChildren.push(currentChildren)}}}return{newClassNames:elementClassNames,newChildren:newChildren}}}]);return Post}();exports.Post=Post;